<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>promise.all() example with async/await</title>
  </head>
  <body>
    <script>
      // Define function to fetch a file and return it in a usable form
      async function fetchAndDecode(url, type) {
        // Returning the top level promise, so the result of the entire chain is returned out of the function
        const response = await fetch(url);

        let content;

        // Throw error is response is not ok.
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        } else {
         // Depending on what type of file is being fetched, use the relevant function to decode its contents
          if(type === 'blob') {
            content = await response.blob();
          } else if(type === 'text') {
            content = await response.text();
          }

          return content;
        }
      }

      async function displayContent() {
        // Call the fetchAndDecode() method to fetch the images and the text, and store their promises in variables
        const coffee = fetchAndDecode('coffee.jpg', 'blob');
        const tea = fetchAndDecode('tea.jpg', 'blob');
        const description = fetchAndDecode('description.txt', 'text');

        // Use Promise.all() to run code only when all three function calls have resolved
        const values = await Promise.all([coffee, tea, description]);

        console.log(values);
        // Store each value returned from the promises in separate variables; create object URLs from the blobs
        const objectURL1 = URL.createObjectURL(values[0]);
        const objectURL2 = URL.createObjectURL(values[1]);
        const descText = values[2];

        // Display the images in <img> elements
        const image1 = document.createElement('img');
        const image2 = document.createElement('img');
        image1.src = objectURL1;
        image2.src = objectURL2;
        document.body.appendChild(image1);
        document.body.appendChild(image2);

        // Display the text in a paragraph
        const para = document.createElement('p');
        para.textContent = descText;
        document.body.appendChild(para);
      };

      displayContent()
        .catch((e) => console.log(e));
    </script>
  </body>
</html>